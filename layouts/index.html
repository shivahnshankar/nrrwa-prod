{{ define "main" }}
<!-- Hero Slider -->
{{ $slides := index .Site.Data.heroSlides .Language.Lang }}
<div class="swiper hero-swiper">
  <div class="swiper-wrapper">
    {{ range $slides }}
    <div class="swiper-slide">
      {{ $imgPath := strings.TrimPrefix "/assets/" .image }}
      {{ $img := resources.Get $imgPath }}
      {{ if $img }}
      {{ $resized := $img.Resize "1920x webp q85" }}
      <img src="{{ $resized.RelPermalink }}" alt="{{ .title }}">
      {{ else }}
      <img src="{{ .image }}" alt="{{ .title }}">
      {{ end }}
      <div class="slide-content">
        <h2>{{ .title }}</h2>
        <p>{{ .description }}</p>
        <a href="{{ .buttonLink }}" class="cta-button">{{ .buttonText }}</a>
      </div>
    </div>
    {{ end }}
  </div>
  <div class="swiper-pagination"></div>
  <div class="swiper-button-prev"></div>
  <div class="swiper-button-next"></div>
</div>

<!-- Upcoming Events -->
<section>
  <div class="container">
    <h2 class="section-title">{{ T "upcoming_events" }}</h2>
    <div class="cards-grid">
      {{ $now := now }}
      {{ $today := $now.Format "2006-01-02" }}
      {{ $events := where .Site.RegularPages "Section" "events" }}
      {{ $events = where $events ".Language.Lang" .Language.Lang }}
      {{ $futureEvents := slice }}
      {{ range $events }}
      {{ $eventDate := .Params.eventDate }}
      {{ if $eventDate }}
      {{ $eventTime := time $eventDate }}
      {{ $eventDay := $eventTime.Format "2006-01-02" }}
      {{ if ge $eventDay $today }}
      {{ $futureEvents = $futureEvents | append . }}
      {{ end }}
      {{ end }}
      {{ end }}
      {{ $sortedEvents := sort $futureEvents "Params.eventDate" }}
      {{ range first 3 $sortedEvents }}
      <div class="card">
        {{ with .Params.featuredImage }}
        {{ $imgPath := strings.TrimPrefix "/assets/" . }}
        {{ $img := resources.Get $imgPath }}
        {{ if $img }}
        {{ $resized := $img.Fill "600x400 webp q85" }}
        <img src="{{ $resized.RelPermalink }}" alt="{{ $.Title }}">
        {{ else }}
        <img src="{{ . }}" alt="{{ $.Title }}">
        {{ end }}
        {{ end }}
        <div class="card-content">
          <div class="blog-meta">
            <span>ðŸ“… {{ time .Params.eventDate | dateFormat "02 Jan 2006" }}</span>
          </div>
          <h3>{{ .Title }}</h3>
          <p>{{ .Params.summary }}</p>
          <a href="{{ .Permalink }}" class="card-link">{{ T "read_more" }} â†’</a>
        </div>
      </div>
      {{ end }}
    </div>
    <div class="text-center mt-4">
      <a href="{{ "/events/" | relLangURL }}" class="cta-button">{{ T "view_all_events" }}</a>
    </div>
  </div>
</section>

<!-- Recent News -->
<section>
  <div class="container">
    <h2 class="section-title">{{ T "latest_news" }}</h2>
    <div class="blog-grid">
      {{ $news := where .Site.RegularPages "Section" "news" }}
      {{ $news := where $news ".Language.Lang" .Language.Lang }}
      {{ $news = where $news "Params.layout" "!=" "archive" }}
      {{ $news := first 3 $news }}
      {{ range $news }}
      <div class="blog-card">
        {{ with .Params.featuredImage }}
        {{ $imgPath := strings.TrimPrefix "/assets/" . }}
        {{ $img := resources.Get $imgPath }}
        {{ if $img }}
        {{ $resized := $img.Fill "600x400 webp q85" }}
        <img src="{{ $resized.RelPermalink }}" alt="{{ $.Title }}">
        {{ else }}
        <img src="{{ . }}" alt="{{ $.Title }}">
        {{ end }}
        {{ end }}
        <div class="blog-card-content">
          <div class="blog-meta">
            <span>ðŸ“… {{ .Date.Format "02 Jan 2006" }}</span>
          </div>
          <h3>{{ .Title }}</h3>
          <p>{{ .Params.summary }}</p>
          <a href="{{ .Permalink }}" class="card-link">{{ T "read_more" }} â†’</a>
        </div>
      </div>
      {{ end }}
    </div>
    <div class="text-center mt-4">
      <a href="{{ "/news/" | relLangURL }}" class="cta-button">{{ T "view_all_news" }}</a>
    </div>
  </div>
</section>

<!-- Stats Section -->
<section class="stats-section">
  <div class="container">
    <div class="stats-grid">
      <div class="stat-item">
        <h3 class="stat-number" data-target="{{ .Site.Params.stats_members }}">0</h3>
        <p>{{ T "active_members" }}</p>
      </div>
      <div class="stat-item">
        <h3 class="stat-number" data-target="{{ .Site.Params.stats_yearsOfService }}">0</h3>
        <p>{{ T "years_of_service" }}</p>
      </div>
      <div class="stat-item">
        <h3 class="stat-number" data-target="{{ .Site.Params.stats_eventsOrganized }}">0</h3>
        <p>{{ T "events_organized" }}</p>
      </div>
      <div class="stat-item">
        <h3 class="stat-number" data-target="{{ .Site.Params.stats_saplingsDistributed }}">0</h3>
        <p>{{ T "saplings_distributed" }}</p>
      </div>
    </div>
  </div>
</section>

<!-- New Members -->
<section>
  <div class="container">
    {{ $members := index .Site.Data.members .Language.Lang }}
    {{ $sortedMembers := sort $members "joinedDate" "desc" }}
    <h2 class="section-title">{{ T "welcome_new_members" }}</h2>
    <div class="cards-grid">
      {{ range $index, $member := first 3 $sortedMembers }}
      <div class="member-card">
        <div class="member-photo">
          <div class="member-avatar avatar-gradient-{{ mod $index 3 }}">
            {{ $initials := "" }}
            {{ range split $member.name " " }}
            {{ $initials = print $initials (substr . 0 1) }}
            {{ end }}
            {{ substr $initials 0 2 }}
          </div>
        </div>
        <div class="card-content text-center">
          <h3>{{ $member.name }}</h3>
          <p class="member-type">{{ $member.membershipType }} {{ T "member" }}</p>
          <p class="member-date">{{ T "joined" }}: {{ $member.joinedDate }}</p>
        </div>
      </div>
      {{ end }}
    </div>
  </div>

  <div class="text-center mt-4">
    <p style="font-size: 1.1rem; color: var(--text-color);">
      {{ T "join_community" (dict "Count" .Site.Params.stats_members) }}
    </p>
    <a href="/{{ .Language.Lang }}/membership/" class="cta-button" style="margin-top: 1rem;">{{ T "become_member"
      }}</a>
  </div>
  </div>
</section>
{{ end }}