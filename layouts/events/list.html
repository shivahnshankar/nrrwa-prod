{{ define "main" }}
{{ $now := now }}
{{ $today := $now.Format "2006-01-02" }}
{{ $allEvents := where .Site.RegularPages "Section" "events" }}
{{ $langPages := where $allEvents ".Language.Lang" .Language.Lang }}

{{ $upcomingEvents := slice }}
{{ $pastEvents := slice }}
{{ range $langPages }}
{{ $eventDate := time .Params.eventDate }}
{{ $eventDay := $eventDate.Format "2006-01-02" }}
{{ if ge $eventDay $today }}
{{ $upcomingEvents = $upcomingEvents | append . }}
{{ else }}
{{ $pastEvents = $pastEvents | append . }}
{{ end }}
{{ end }}

<!-- Sort: upcoming by date ascending, past by date descending -->
{{ $upcomingEvents = sort $upcomingEvents ".Params.eventDate" "asc" }}
{{ $pastEvents = sort $pastEvents ".Params.eventDate" "desc" }}

<!-- Combine: upcoming first, then past -->
{{ $allSortedEvents := $upcomingEvents | append $pastEvents }}

{{ $paginator := .Paginate $allSortedEvents 6 }}

<div class="container">
  <h1 class="section-title">{{ T "events" }}</h1>

  <!-- Upcoming Events Section -->
  {{ $upcomingOnPage := slice }}
  {{ $pastOnPage := slice }}
  {{ range $paginator.Pages }}
  {{ $eventDate := time .Params.eventDate }}
  {{ $eventDay := $eventDate.Format "2006-01-02" }}
  {{ if ge $eventDay $today }}
  {{ $upcomingOnPage = $upcomingOnPage | append . }}
  {{ else }}
  {{ $pastOnPage = $pastOnPage | append . }}
  {{ end }}
  {{ end }}

  {{ if gt (len $upcomingOnPage) 0 }}
  <section>
    <h2 class="section-subtitle">{{ T "upcoming_events" }}</h2>
    <div class="cards-grid">
      {{ range $upcomingOnPage }}
      <div class="card">
        {{ with .Params.featuredImage }}
        {{ $imgPath := strings.TrimPrefix "/assets/" . }}
        {{ $img := resources.Get $imgPath }}
        {{ if $img }}
        {{ $resized := $img.Fill "600x400 webp q85" }}
        <img src="{{ $resized.RelPermalink }}" alt="{{ $.Title }}">
        {{ else }}
        <img src="{{ . }}" alt="{{ $.Title }}">
        {{ end }}
        {{ else }}
        <div class="card-placeholder"
          style="background: linear-gradient(135deg, #4a7c59 0%, #2d5a3a 100%); height: 200px; display: flex; align-items: center; justify-content: center; font-size: 3rem;">
          üìÖ</div>
        {{ end }}
        <div class="card-content">
          <div class="blog-meta">
            {{ with .Params.eventDate }}
            <span>üìÖ {{ dateFormat "02 Jan 2006" . }}</span>
            {{ end }}
            {{ with .Params.tags }}
            <span>üè∑Ô∏è {{ delimit . ", " }}</span>
            {{ end }}
          </div>
          <h3>{{ .Title }}</h3>
          <p>{{ .Params.summary }}</p>
          <a href="{{ .Permalink }}" class="card-link">{{ if eq $.Language.Lang "en" }}Learn More{{ else }}‡≤á‡≤®‡≥ç‡≤®‡≤∑‡≥ç‡≤ü‡≥Å
            ‡≤§‡≤ø‡≤≥‡≤ø‡≤Ø‡≤ø‡≤∞‡≤ø{{ end }} ‚Üí</a>
        </div>
      </div>
      {{ end }}
    </div>
  </section>
  {{ else if eq $paginator.PageNumber 1 }}
  <section>
    <h2 class="section-subtitle">{{ T "upcoming_events" }}</h2>
    <div class="cards-grid">
      <div class="card">
        <div class="card-content">
          <p style="text-align: center; color: var(--color-text-secondary);">{{ T "no_upcoming_events" }}</p>
        </div>
      </div>
    </div>
  </section>
  {{ end }}

  <!-- Past Events Section -->
  {{ if gt (len $pastOnPage) 0 }}
  <section style="margin-top: 4rem;">
    <h2 class="section-subtitle">{{ T "past_events" }}</h2>
    <div class="cards-grid">
      {{ range $pastOnPage }}
      <div class="card">
        {{ with .Params.featuredImage }}
        {{ $imgPath := strings.TrimPrefix "/assets/" . }}
        {{ $img := resources.Get $imgPath }}
        {{ if $img }}
        {{ $resized := $img.Fill "600x400 webp q85" }}
        <img src="{{ $resized.RelPermalink }}" alt="{{ $.Title }}" style="opacity: 0.8;">
        {{ else }}
        <img src="{{ . }}" alt="{{ $.Title }}" style="opacity: 0.8;">
        {{ end }}
        {{ else }}
        <div class="card-placeholder"
          style="background: linear-gradient(135deg, #888 0%, #666 100%); height: 200px; display: flex; align-items: center; justify-content: center; font-size: 3rem;">
          üìÖ</div>
        {{ end }}
        <div class="card-content">
          <div class="blog-meta">
            {{ with .Params.eventDate }}
            <span>üìÖ {{ dateFormat "02 Jan 2006" . }}</span>
            {{ end }}
          </div>
          <h3>{{ .Title }}</h3>
          <p>{{ .Params.summary }}</p>
          <a href="{{ .Permalink }}" class="card-link">{{ if eq $.Language.Lang "en" }}View Details{{ else }}‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å
            ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø{{ end }} ‚Üí</a>
        </div>
      </div>
      {{ end }}
    </div>
  </section>
  {{ end }}

  <!-- Pagination -->
  {{ template "_internal/pagination.html" . }}
</div>
{{ end }}